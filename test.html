<!DOCTYPE html>
<html lang="en">
<head>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  
  <style>
    * {
      padding:0;
      margin:0;
    }
    html, body {
      width: 100%; 
      height: 100%;
    }

    #heatmapArea {
      height: 100%;
      width: 100%;
    }

  </style>
  </head>
<body>

<div id="heatmapArea"> </div>

<script type="text/javascript" src="heatmap.js"></script>
<script type="text/javascript" src="heatmap-gmaps.js"></script>
<script type="text/javascript">

  var Data = [[44.626,-63.425,"","2013-09-06T17:44:44.223Z"], [44.606,-63.614,"","2013-09-06T17:44:44.227Z"], [44.649,-63.578,"","2013-09-06T17:44:44.228Z"], [44.658,-63.596,"","2013-09-06T17:44:44.230Z"], [44.614,-63.62,"","2013-09-06T17:44:44.231Z"], [44.652,-63.588,"","2013-09-06T17:44:44.233Z"], [44.718,-63.545,"","2013-09-06T17:44:44.234Z"], [44.707,-63.552,"","2013-09-06T17:44:44.236Z"], [44.728,-63.652,"","2013-09-06T17:44:44.237Z"], [44.627,-63.628,"","2013-09-06T17:44:44.240Z"], [44.651,-63.586,"","2013-09-06T17:44:44.241Z"], [44.681,-63.583,"","2013-09-06T17:44:44.243Z"], [44.648,-63.725,"","2013-09-06T17:44:44.244Z"], [44.605,-63.61,"","2013-09-06T17:44:44.246Z"], [44.616,-63.481,"","2013-09-06T17:44:44.247Z"], [44.789,-63.715,"","2013-09-06T17:44:44.251Z"], [44.632,-63.635,"","2013-09-06T17:44:44.253Z"], [44.652,-63.634,"","2013-09-06T17:44:44.256Z"], [44.72,-63.676,"","2013-09-06T17:44:44.257Z"], [44.672,-63.578,"","2013-09-06T17:44:44.258Z"], [44.643,-63.589,"","2013-09-06T17:44:44.260Z"], [44.681,-63.584,"","2013-09-06T17:44:44.261Z"], [44.678,-63.591,"","2013-09-06T17:44:44.263Z"], [44.672,-63.669,"","2013-09-06T17:44:44.263Z"], [44.66,-63.598,"","2013-09-06T17:44:44.265Z"], [44.603,-63.612,"","2013-09-06T17:44:44.266Z"], [44.641,-63.578,"","2013-09-06T17:44:44.268Z"], [44.647,-63.619,"","2013-09-06T17:44:44.269Z"], [44.769,-63.688,"","2013-09-06T17:44:44.271Z"], [44.669,-63.601,"","2013-09-06T17:44:44.274Z"], [44.702,-63.612,"","2013-09-06T17:44:44.274Z"], [44.758,-63.66,"","2013-09-06T17:44:44.276Z"], [44.651,-63.575,"","2013-09-06T17:44:44.278Z"], [44.672,-63.588,"","2013-09-06T17:44:44.279Z"], [44.83,-63.598,"","2013-09-06T17:44:44.281Z"], [44.663,-63.633,"","2013-09-06T17:44:44.282Z"], [44.76,-63.667,"","2013-09-06T17:44:44.284Z"], [44.657,-63.631,"","2013-09-06T17:44:44.285Z"], [44.816,-63.767,"","2013-09-06T17:44:44.287Z"], [44.638,-63.62,"","2013-09-06T17:44:44.288Z"], [44.688,-63.529,"","2013-09-06T17:44:44.290Z"], [44.651,-63.596,"","2013-09-06T17:44:44.292Z"], [44.662,-63.66,"","2013-09-06T17:44:44.293Z"], [44.79,-63.7,"","2013-09-06T17:44:44.295Z"], [44.666,-63.551,"","2013-09-06T17:44:44.296Z"], [44.691,-63.492,"","2013-09-06T17:44:44.298Z"], [44.685,-63.668,"","2013-09-06T17:44:44.299Z"], [44.762,-63.69,"","2013-09-06T17:44:44.301Z"], [44.656,-63.591,"","2013-09-06T17:44:44.302Z"], [44.643,-63.711,"","2013-09-06T17:44:44.304Z"], [44.682,-63.524,"","2013-09-06T17:44:44.304Z"], [44.599,-63.686,"","2013-09-06T17:44:44.307Z"], [44.677,-63.529,"","2013-09-06T17:44:44.308Z"], [44.811,-63.603,"","2013-09-06T17:44:44.312Z"], [44.661,-63.549,"","2013-09-06T17:44:44.314Z"], [44.643,-63.569,"","2013-09-06T17:44:44.316Z"], [44.685,-63.587,"","2013-09-06T17:44:44.317Z"], [44.645,-63.603,"","2013-09-06T17:44:44.318Z"], [44.675,-63.527,"","2013-09-06T17:44:44.320Z"], [44.714,-63.437,"","2013-09-06T17:44:44.321Z"], [44.695,-63.671,"","2013-09-06T17:44:44.324Z"], [44.666,-63.538,"","2013-09-06T17:44:44.325Z"], [44.667,-63.579,"","2013-09-06T17:44:44.327Z"], [44.642,-63.705,"","2013-09-06T17:44:44.328Z"], [44.646,-63.633,"","2013-09-06T17:44:44.330Z"], [44.651,-63.648,"","2013-09-06T17:44:44.333Z"], [44.669,-63.669,"","2013-09-06T17:44:44.333Z"], [44.811,-63.603,"","2013-09-06T17:44:44.335Z"], [44.603,-63.609,"","2013-09-06T17:44:44.336Z"], [44.732,-63.646,"","2013-09-06T17:44:44.338Z"], [44.654,-63.635,"","2013-09-06T17:44:44.340Z"], [44.648,-63.576,"","2013-09-06T17:44:44.341Z"], [44.668,-63.543,"","2013-09-06T17:44:44.343Z"], [44.679,-63.549,"","2013-09-06T17:44:44.345Z"], [44.645,-63.586,"","2013-09-06T17:44:44.346Z"], [44.728,-63.658,"","2013-09-06T17:44:44.347Z"], [44.732,-63.651,"","2013-09-06T17:44:44.348Z"], [44.811,-63.603,"","2013-09-06T17:44:44.351Z"], [44.732,-63.65,"","2013-09-06T17:44:44.351Z"], [44.66,-63.653,"","2013-09-06T17:44:44.353Z"], [44.636,-63.58,"","2013-09-06T17:44:44.354Z"], [44.669,-63.601,"","2013-09-06T17:44:44.356Z"], [44.693,-63.681,"","2013-09-06T17:44:44.358Z"], [44.699,-63.668,"","2013-09-06T17:44:44.359Z"], [44.661,-63.545,"","2013-09-06T17:44:44.361Z"], [44.668,-63.663,"","2013-09-06T17:44:44.362Z"], [44.65,-63.586,"","2013-09-06T17:44:44.364Z"], [44.65,-63.586,"","2013-09-06T17:44:44.365Z"], [44.652,-63.585,"","2013-09-06T17:44:44.367Z"], [44.657,-63.532,"","2013-09-06T17:44:44.368Z"], [44.654,-63.645,"","2013-09-06T17:44:44.370Z"], [44.694,-63.307,"","2013-09-06T17:44:44.371Z"], [44.653,-63.593,"","2013-09-06T17:44:44.374Z"], [44.824,-63.616,"","2013-09-06T17:44:44.375Z"], [44.764,-63.676,"","2013-09-06T17:44:44.377Z"], [44.608,-63.469,"","2013-09-06T17:44:44.378Z"], [44.648,-63.574,"","2013-09-06T17:44:44.380Z"], [44.706,-63.687,"","2013-09-06T17:44:44.381Z"], [44.654,-63.586,"","2013-09-06T17:44:44.385Z"], [44.694,-63.674,"","2013-09-06T17:44:44.385Z"], [44.642,-63.57,"","2013-09-06T17:44:44.386Z"], [44.699,-63.668,"","2013-09-06T17:44:44.388Z"], [44.705,-63.689,"","2013-09-06T17:44:44.389Z"], [44.653,-63.645,"","2013-09-06T17:44:44.391Z"], [44.697,-63.431,"","2013-09-06T17:44:44.393Z"], [44.673,-63.578,"","2013-09-06T17:44:44.394Z"], [44.614,-63.619,"","2013-09-06T17:44:44.396Z"], [44.701,-63.678,"","2013-09-06T17:44:44.398Z"], [44.684,-63.514,"","2013-09-06T17:44:44.399Z"], [44.682,-63.51,"","2013-09-06T17:44:44.400Z"], [44.664,-63.65,"","2013-09-06T17:44:44.402Z"], [44.657,-63.596,"","2013-09-06T17:44:44.403Z"], [44.662,-63.656,"","2013-09-06T17:44:44.405Z"], [44.655,-63.612,"","2013-09-06T17:44:44.407Z"], [44.624,-63.593,"","2013-09-06T17:44:44.409Z"], [44.719,-63.589,"","2013-09-06T17:44:44.410Z"], [44.692,-63.892,"","2013-09-06T17:44:44.411Z"], [44.706,-63.592,"","2013-09-06T17:44:44.413Z"], [44.668,-63.57,"","2013-09-06T17:44:44.414Z"], [44.664,-63.93,"","2013-09-06T17:44:44.416Z"], [44.655,-63.589,"","2013-09-06T17:44:44.417Z"], [44.652,-63.591,"","2013-09-06T17:44:44.419Z"], [44.68,-63.676,"","2013-09-06T17:44:44.420Z"], [44.699,-63.668,"","2013-09-06T17:44:44.422Z"], [44.672,-63.583,"","2013-09-06T17:44:44.424Z"], [44.666,-63.949,"","2013-09-06T17:44:44.426Z"], [44.726,-63.665,"","2013-09-06T17:44:44.427Z"], [44.615,-63.616,"","2013-09-06T17:44:44.429Z"], [44.631,-63.633,"","2013-09-06T17:44:44.429Z"], [44.689,-63.53,"","2013-09-06T17:44:44.430Z"], [44.653,-63.585,"","2013-09-06T17:44:44.433Z"], [44.651,-63.425,"","2013-09-06T17:44:44.438Z"], [44.655,-63.598,"","2013-09-06T17:44:44.449Z"], [44.686,-63.584,"","2013-09-06T17:44:44.449Z"], [44.655,-63.606,"","2013-09-06T17:44:44.451Z"], [44.653,-63.652,"","2013-09-06T17:44:44.452Z"], [44.673,-63.932,"","2013-09-06T17:44:44.454Z"], [44.674,-63.491,"","2013-09-06T17:44:44.455Z"], [44.681,-63.519,"","2013-09-06T17:44:44.457Z"], [44.674,-63.676,"","2013-09-06T17:44:44.459Z"], [44.655,-63.552,"","2013-09-06T17:44:44.461Z"], [44.69,-63.537,"","2013-09-06T17:44:44.462Z"], [44.655,-63.552,"","2013-09-06T17:44:44.464Z"], [44.687,-63.311,"","2013-09-06T17:44:44.465Z"], [44.707,-63.567,"","2013-09-06T17:44:44.465Z"], [44.71,-63.609,"","2013-09-06T17:44:44.466Z"], [44.672,-63.553,"","2013-09-06T17:44:44.466Z"], [44.719,-63.589,"","2013-09-06T17:44:44.466Z"], [44.636,-63.585,"","2013-09-06T17:44:44.466Z"], [44.685,-63.587,"","2013-09-06T17:44:44.467Z"]];
  function getHeatmapData(crimeData, typeFilters) {
    var points = {};
    for(var i = crimeData.length-1 ; i >= 0 ; i--) {
      var crime = crimeData[i];
      var type = crime[2];

      if(typeFilters && typefilters.indexOf(type) === -1)
        continue;

      var lat = crime[0];
      var lon = crime[1];
      var date = new Date(crime[3]);

      var pointsX = points[lat];
      if(!pointsX) {
        pointsX = [];
        points[lat] = pointsX;
      }

      var point = pointsX[lon];
      if(!point) {
        point = {lat : crime[0], lng : crime[1], count: 0};
        pointsX[lon] = point;
      }
      point.count += 1;
    }

    var heatmapData = [];
    var max = 1;
    for(var x in points) {
      var pointsX = points[x];
      for(var y in pointsX) {
        var point = pointsX[y];
        heatmapData.push(point);

        if(point.count > max)
          max = point.count;
      }
    }

    return {max: max, data: heatmapData};
  }

        !function($){
            $(function(){

    var myLatlng = new google.maps.LatLng(44.6544, -63.5992);

    var myOptions = {
      zoom: 12,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      disableDefaultUI: false,
      scrollwheel: true,
      draggable: true,
      navigationControl: true,
      mapTypeControl: false,
      scaleControl: true,
      disableDoubleClickZoom: false
    };
    var map = new google.maps.Map($("#heatmapArea")[0], myOptions);
    
    var heatmap = new HeatmapOverlay(map, {
        "radius":30,
        "visible":true, 
        "opacity":50
    });
  
    
    var heatmapData = getHeatmapData(Data);
    // this is important, because if you set the data set too early, the latlng/pixel projection doesn't work
    google.maps.event.addListenerOnce(map, "idle", function() {
        window.setInterval(function() {
          heatmap.setDataSet(getHeatmapData(Data));
          console.log('redrawing');
        }, 900)
        
        heatmap.setDataSet(heatmapData);
    });

            });
        }(window.jQuery)
    </script>
</body>
</html>